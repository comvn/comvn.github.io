<!doctype html>
<html>
<meta charset="utf-8" />

<body>

<a href="#" id="downloader" onclick="download();" download="image.png">Tải ảnh QR!</a>

<p></p>

<canvas id="myCanvas" width="1489" height="1000" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<script>

//default
var name = "DAO ANH NGUYEN";
var accNumber = "0912345678";
var qr = "00020101021138540010A00000072701240006970432011009323886850208QRIBFTTA53037045802VN6304A349";
var standee = "standee1.png";

const urlParams = new URLSearchParams(window.location.search);
const myParamName = urlParams.get('name');
const myParamAccNumber = urlParams.get('acc');
const myParamQr = urlParams.get('qr');
const myParamStandee = urlParams.get('standee');

if(myParamName)
	name = myParamName;
	
if(myParamAccNumber)
	accNumber = myParamAccNumber;
	
if(myParamQr)
	qr = myParamQr;
	
if(myParamStandee)
	standee = "standee" + myParamStandee + ".png";

var linkqr = "https://chart.googleapis.com/chart?cht=qr&chl=" + qr + "&chs=300x300&choe=UTF-8&chld=L|0";

var c=document.getElementById("myCanvas");

async function myfunction(url) {
  return new Promise(r => { let i = new Image();img.crossOrigin="anonymous"; i.onload = (() => r(i)); i.src = url; });
}

function start(url) {
  return myfunction(url);
}

// Call start
(async() => {
  console.log('before start');
  console.log('linkqr' + linkqr);
  
  let img_standee = await start("./" + standee);
  
  let img = await start(linkqr);
  
  
  let logo_vietqr = await start("./logos-vietqr.png");
  let logo_napas247 = await start("./napas247s.png");
  
	var ctx = c.getContext('2d');

	ctx.fillStyle = "white";
	ctx.fillRect(0, 0, c.width, c.height);

    ctx.drawImage(img_standee, 0, 0);
	
	ctx.drawImage(img, 1050, 300);
	
	ctx.drawImage(logo_vietqr, 1050, 640);
	
	ctx.drawImage(logo_napas247, 1240, 640);
	
	ctx.fillStyle = "black";
	
	ctx.textAlign = "center";
	ctx.font="25px Arial";
	ctx.fillText(name, 1200, 770);

	ctx.font="20px Arial";
	ctx.fillText(accNumber, 1200, 810);
	

	// save img
	//Canvas2Image.saveAsImage(c, 500, 500, 'png');
  
  console.log('after start');
})();


async function loadImage(url) {
  return new Promise(r => { let i = new Image(); i.onload = (() => r(i)); i.src = url; });
}

function download(){
    document.getElementById("downloader").download = "image_qr_customize_name.png";
    document.getElementById("downloader").href = document.getElementById("myCanvas").toDataURL("image/png").replace(/^data:image\/[^;]/, 'data:application/octet-stream');
}


</script>

</body>
</html>
